/**
 * smoothState.js is a jQuery plugin to stop page load jank.
 *
 * This jQuery plugin progressively enhances page loads to
 * behave more like a single-page application.
 *
 * @author  Miguel Ángel Pérez   reachme@miguel-perez.com
 * @see     https://github.com/miguel-perez/jquery.smoothState.js
 *
 */(function(e,t,n,r){"use strict";if(!history.pushState){e.fn.smoothState=function(){return this};e.fn.smoothState.options={};return}if(e.fn.smoothState)return;var i=e("html, body"),s=t.console||!1,o={anchors:"a",prefetch:!1,blacklist:".no-smoothstate, [target]",development:!1,pageCacheSize:0,alterRequestUrl:function(e){return e},onStart:{duration:0,render:function(e,t){i.scrollTop(0)}},onProgress:{duration:0,render:function(e,t){i.css("cursor","wait");i.find("a").css("cursor","wait")}},onEnd:{duration:0,render:function(e,t,n){i.css("cursor","auto");i.find("a").css("cursor","auto");t.html(n)}},callback:function(e,t,n){}},u={isExternal:function(e){var n=e.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return typeof n[1]=="string"&&n[1].length>0&&n[1].toLowerCase()!==t.location.protocol?!0:typeof n[2]=="string"&&n[2].length>0&&n[2].replace(new RegExp(":("+{"http:":80,"https:":443}[t.location.protocol]+")?$"),"")!==t.location.host?!0:!1},isHash:function(e){var n=e.indexOf(t.location.pathname)>0?!0:!1,r=e.indexOf("#")>0?!0:!1;return n&&r?!0:!1},shouldLoad:function(e,t){var n=e.prop("href");return!u.isExternal(n)&&!u.isHash(n)&&!e.is(t)},htmlDoc:function(t){var n,r=e(),i=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/ig,s="ss"+Math.round(Math.random()*1e5),o=t.replace(i,function(t,n,i,o){var u={};if(!n){e.merge(r,e("<"+i+"/>"));o&&e.each(e("<div"+o+"/>")[0].attributes,function(e,t){u[t.name]=t.value});r.eq(-1).attr(u)}return"<"+n+"div"+(n?"":" id='"+s+(r.length-1)+"'")+">"});if(!r.length)return e(t);n||(n=e("<div/>"));n.html(o);e.each(r,function(e){var t=n.find("#"+s+e).before(r[e]);r.eq(e).html(t.contents());t.remove()});return n.children().unwrap()},clearIfOverCapacity:function(e,t){Object.keys||(Object.keys=function(e){var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t});Object.keys(e).length>t&&(e={});return e},getContentById:function(t,n){n=n instanceof jQuery?n:u.htmlDoc(n);var r=n.find(t),i=r.length?e.trim(r.html()):n.filter(t).html(),s=i.length?e(i):null;return s},storePageIn:function(e,t,n){n=n instanceof jQuery?n:u.htmlDoc(n);e[t]={status:"loaded",title:n.find("title").text(),html:n};return e},triggerAllAnimationEndEvent:function(t,n){n=" "+n||"";var r=0,i="animationstart webkitAnimationStart oanimationstart MSAnimationStart",s="animationend webkitAnimationEnd oanimationend MSAnimationEnd",o="allanimationend",a=function(n){if(e(n.delegateTarget).is(t)){n.stopPropagation();r++}},f=function(n){if(e(n.delegateTarget).is(t)){n.stopPropagation();r--;r===0&&t.trigger(o)}};t.on(i,a);t.on(s,f);t.on("allanimationend"+n,function(){r=0;u.redraw(t)})},redraw:function(e){e.height(0);setTimeout(function(){e.height("auto")},0)}},a=function(n){if(n.state!==null){var r=t.location.href,i=e("#"+n.state.id),s=i.data("smoothState");s.href!==r&&!u.isHash(r)&&s.load(r,!0)}},f=function(r,i){var o=e(r),a={},f=t.location.href,l=function(e,n){n=n||!1;var r=!1,s=!1,u={loaded:function(){var i=r?"ss.onProgressEnd":"ss.onStartEnd";!s||!r?o.one(i,function(){c(e)}):s&&c(e);n||t.history.pushState({id:o.prop("id")},a[e].title,e)},fetching:function(){if(!r){r=!0;o.one("ss.onStartEnd",function(){i.onProgress.render(e,o,null);setTimeout(function(){o.trigger("ss.onProgressEnd");s=!0},i.onStart.duration)})}setTimeout(function(){a.hasOwnProperty(e)&&u[a[e].status]()},10)},error:function(){t.location=e}};a.hasOwnProperty(e)||h(e);i.onStart.render(e,o,null);setTimeout(function(){o.trigger("ss.onStartEnd")},i.onStart.duration);u[a[e].status]()},c=function(e){var r="#"+o.prop("id"),f=a[e]?u.getContentById(r,a[e].html):null;if(f){n.title=a[e].title;o.data("smoothState").href=e;i.onEnd.render(e,o,f);o.one("ss.onEndEnd",function(){i.callback(e,o,f)});setTimeout(function(){o.trigger("ss.onEndEnd")},i.onEnd.duration)}else!f&&i.development&&s?s.warn("No element with an id of "+r+" in response from "+e+" in "+a):t.location=e},h=function(t){if(a.hasOwnProperty(t))return;a=u.clearIfOverCapacity(a,i.pageCacheSize);a[t]={status:"fetching"};var n=i.alterRequestUrl(t)||t,r=e.ajax(n);r.success(function(e){u.storePageIn(a,t,e);o.data("smoothState").cache=a});r.error(function(){a[t].status="error"})},p=function(t){var n=e(t.currentTarget),r=n.prop("href");if(u.shouldLoad(n,i.blacklist)){t.stopPropagation();h(r)}},d=function(t){var n=e(t.currentTarget),r=n.prop("href");if(!t.metaKey&&!t.ctrlKey&&u.shouldLoad(n,i.blacklist)){t.stopPropagation();t.preventDefault();l(r)}},v=function(e){e.on("click",i.anchors,d);i.prefetch&&e.on("mouseover touchstart",i.anchors,p)},m=function(e){var t=o.addClass(e).prop("class");o.removeClass(t);setTimeout(function(){o.addClass(t)},0);o.one("ss.onStartEnd ss.onProgressEnd ss.onEndEnd",function(){o.removeClass(e)})};i=e.extend({},e.fn.smoothState.options,i);t.history.state===null&&t.history.replaceState({id:o.prop("id")},n.title,f);u.storePageIn(a,f,n.documentElement.outerHTML);u.triggerAllAnimationEndEvent(o,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd");v(o);return{href:f,cache:a,load:l,fetch:h,toggleAnimationClass:m}},l=function(t){return this.each(function(){this.id&&!e.data(this,"smoothState")?e.data(this,"smoothState",new f(this,t)):!this.id&&s&&s.warn("Every smoothState container needs an id but the following one does not have one:",this)})};t.onpopstate=a;e.smoothStateUtility=u;e.fn.smoothState=l;e.fn.smoothState.options=o})(jQuery,window,document);